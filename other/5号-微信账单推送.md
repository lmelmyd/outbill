---
title: 微信账单推送
create: 2017.08.07
---

\[TOC\]

准备完成后，可手动执行，也可脚本执行

第一步的执行语句为：

create table TB\_WX\_USER as

select to\_char\(sync\_date,’yyyymm’\) cycle\_id, b.Area\_Code eparchy\_code, serial\_number, sync\_date

from UCR\_ITF1.TB\_WX\_USER@uqry\_sel\_to\_hastadb1 a, ucr\_param.td\_msisdn\_seg b

where substr\(a.serial\_number,1,7\) = b.msisdn\_seg;

第二步执行的数据库内对象是： p\_as\_wx\_user\_bill\_new

# 准备

```sql
    --1和3域执行
    delete work_wk.cbss_td_b_noteitem;
    insert into work_wk.cbss_td_b_noteitem
    select * from work_wk.vw_cbss_td_b_noteitem;
    commit;
```

# 手动执行

```
--1域
p_as_wx_user_bill_new(1);
--1，2，3，4域,顺序执行
p_as_wx_user_bill_new(2);
p_as_wx_user_bill_new(3);
```

# 脚本执行

```
2域 cz_sh/目录
nohup ./run_wx_user_bill_all.sh
```

# 查看状态

```
--没有状态为0的即为执行完成
select flag,count(1) 
from tb_wx_act_user a 
where a.cycle_id='201701'
group by flag;
```



